- [CMake基础](#cmake基础)
  - [搭建项目](#搭建项目)
  - [版本管理](#版本管理)
    - [相关命令](#相关命令)
  - [建立项目](#建立项目)
  - [注释](#注释)
  - [编译](#编译)
  - [CMake相关概念](#cmake相关概念)
    - [范围](#范围)


# CMake基础

CMake工具，除了编译构建，还有辅助自动化测试的CTest，还有辅助打包的CPack。其中最核心就是可以**跨平台**编译构建。

## 搭建项目

1. 想要搭建CMake编译管理代码，首先第一步就是要建立一个保存编译步骤的文件：```CMakeLists.txt```, 我们需要编写我们需要怎么构建编译项目来告诉CMake，类似```Makefile```
并且这个```CMakeLists.txt```是跨平台的，它可以让我们不用关心不同平台编译细节。
2. 还有一个最基础的概念是**构建目录**，即所有CMake生成的中间文件以及平台相关的产物都会在构建目录中，其中比较重要的一个文件是```CMakeCache.txt```,这里面包含了此次编译的编译选项，自定义条件，编译工具链信息等
3. 作为一门语言，CMake对于大小写是不敏感的，所以CMake的命令可以大小写混合

## 版本管理

CMake自身也是有版本的，那么在使用CMake的时候就需要声明使用的CMake版本，避免自己写的CMakeLists的特性在其他系统的CMake版本不适应。

### 相关命令
```CMAKE_MINIMUM_REQUIRED()```
1. CMake会在构建时检测版本，且会及时报错。
2. 会强制要求CMake匹配当前版本的一些设置。

建议每个```CMakeCache.txt```开头的第一条命令都是版本控制命令

>实际开发中，如果要适配的平台系统CMake版本很旧，建议升级CMake，但是对于项目依赖别的项目，那么就要尽量去使用同一版本

## 建立项目

1. 想搭建项目，那么就要给项目起名字可以使用：  

    ```PROJECT(name version language)```
    * ```name``` 项目名字 
    * ```version```项目版本号 
    * ```language``` 项目代码使用什么语言，默认是 C 和 CXX

    这条命令主要做几件事：
    * 检查编译器是否支持 ```language```指定的语言
    * 将编译器信息记录在```CMakeCache.txt```中，这样下次编译就不需要再检查，提高效率


2. 确定项目名字后，那么一般情况下要么想生成一个库，要么想生成一个可执行问界，对于生成可执行文件可以使用：

    ```add_executable(target option source_file1 ...)```

    * ```target``` 项目名
    * ```source_file``` 依赖得源文件
    * ```option``` 选项
      * ```WIN32``` 如果在window平台编译，则会创建窗口程序
      * ```MACOS_BUNDLE``` 如果在mac平台编译，则会创建窗口程序
      * ```EXCLUDE_FROM_ALL``` 将当前target设置为，默认不编译状态，即执行编译时，不会一起编译，只能通过单独编译

    默认情况下，生成得可执行文件得名字是就是项目名字，如果想同时生成多个可执行文件，只需要重复调用命令即可，如果存在同名，那么就会在编译时报错

    如果想生成库那么使用：

    ```add_library(target type EXCLUDE_FROM_ALL source...)```

     * ```target``` 项目名
     * ```type``` 库类型
       * ```STATIC``` 静态库
       * ```SHARED``` 动态库
       * ```MODULE``` 插件库

## 注释
一般来说 单行注释使用```#```开头，多行注释使用```#[=[ xxx ]=]```例如：

```
# this is cmake

#[=[
 this is block comment
]=]

```

## 编译
执行编译一般用到2条命令：

```
# 构建cmake
cmake -B build

# 编译
cmake --build build
```

这有个注意点：  
* 当我们需要更换编译器时，需要查看下CMake当前版本支持哪些：  
利用```cmake --version```查看  
* 然后利用```cmake -G "xxx"```在构建时候之间指定

## CMake相关概念

### 范围

* ```PUBLIC``` : 让所有属性都会导出到对应目标以及使用该目标的目标
* ```PRIVATE```: 只会导出到对应的目标
* ```INTERFACE```:只会导出给使用这个目标的目标